window.TimeIntel=function(e,t){"use strict";if(!(this instanceof TimeIntel))return new TimeIntel(e,t);if("undefined"==typeof locale||"object"!=typeof locale)return void console.error("TimeIntel: Locale not included.");if("undefined"==typeof moment||"function"!=typeof moment)return void console.error("TimeIntel: moment.js not included.");var o={lang:"en",format:"s"},r=!0;t=t||{},this.selector=e||null,this.options={};for(var n in t)if("undefined"==typeof o[n])return r=!1,void console.warn('The option "'+n+'" is not supported.');if(r)for(var s in o)this.options[s]=t[s]||o[s];this.sortLocaleByPriority(),moment.locale(this.options.lang)},TimeIntel.prototype.getElements=function(){return"#"===this.selector.substring(0,1)?[document.getElementById(this.selector.substring(1))]:document.getElementsByClassName(this.selector.substring(1))},TimeIntel.prototype.getValues=function(){for(var e=this.getElements(),t=[],o=0;o<e.length;o++)t.push(e[o].value||e[o].innerHTML);return t},TimeIntel.prototype.getDurations=function(){var e=this.text2num(this.getValues()),t=[];for(var o in locale.time)for(var r=this.getRegex(o,locale.time[o]),n=0;n<e.length;n++)t[n]=t[n]||null,null!==e[n].match(r)&&null===t[n]&&(t[n]=e[n].match(r)[0]);return t},TimeIntel.prototype.getFormattedDurations=function(e){"undefined"!=typeof e&&this.setFormat(e);for(var t=this.getDurations(),o=new RegExp(this.prepareRegex(locale.combine,"\\b"),"i"),r=[],n=0;n<t.length;n++)if(r[n]=null,"undefined"==typeof t[n]||null!==t[n]){var s;s=o.test(t[n])?this.getFormattedPeriod(t[n]):this.getFormattedPlain(t[n]),r[n]=s}return r},TimeIntel.prototype.getFormattedPeriod=function(e){var t=new RegExp("\\s+(?:"+this.prepareRegex(locale.combine,"\\b")+")\\s+","i"),o=e.split(t),r=moment(o[0],"HH:mm"),n=moment(o[1],"HH:mm");r.diff(n)>0&&n.add(12,"h");var s=moment.duration(n.diff(r)).asSeconds();return this.calculate(s)},TimeIntel.prototype.getFormattedPlain=function(e){var t,o=locale.time.duration.props,r=(e.match(/\d+/g)||["1"]).join();for(var n in o){var s=new RegExp(this.prepareRegex(o[n].keywords,"\\b"),"i");if(s.test(e)){t=n;break}}"undefined"==typeof t&&(t="hours");var i=r*locale.time.duration.props[t].multiply;return this.calculate(i)},TimeIntel.prototype.getFormat=function(e){return this.options.format},TimeIntel.prototype.setFormat=function(e){this.options.format=e},TimeIntel.prototype.getRegex=function(e){var t=[];for(var o in locale.time[e].props)t.push("("+this.prepareRegex(locale.time[e].props[o].keywords,"\\b")+")");var r=t.length>1?"("+t.join("|")+")":t.join(),n="("+this.prepareRegex(locale.combine,"\\b")+")";return"periods"===e?regex="(\\d+:\\d+\\s+"+r+"\\s+"+n+"\\s+\\d+:\\d+\\s+"+r+")|("+r+"\\s+\\d+:\\d+\\s+"+n+"\\s+"+r+"\\s+\\d+:\\d+)|(\\d+:\\d+\\s+"+r+"\\s+"+n+"\\s+\\d+:\\d+)|("+r+"\\s+\\d+:\\d+\\s+"+n+"\\s+\\d+:\\d+)|(\\d+:\\d+\\s+"+n+"\\s+\\d+:\\d+\\s+"+r+")|(\\d+:\\d+\\s+"+n+"\\s+"+r+"\\s+\\d+:\\d+)|(\\d+:\\d+\\s+"+n+"\\s+\\d+:\\d+)|(\\d+\\s+"+r+"\\s+"+n+"\\s+\\d+\\s+"+r+")|("+r+"\\s+\\d+\\s+"+n+"\\s+"+r+"\\s+\\d+)|(\\d+\\s+"+r+"\\s+"+n+"\\s+\\d+)|("+r+"\\s+\\d+\\s+"+n+"\\s+\\d+)|(\\d+\\s+"+n+"\\s+\\d+\\s+"+r+")|(\\d+\\s+"+n+"\\s+"+r+"\\s+\\d+)|(\\d+\\s+"+n+"\\s+\\d+)|":regex="(\\d+:\\d+\\s+"+r+")|("+r+"\\s+\\d+:\\d+)|(\\d+:\\d+)|(\\d+\\s+"+r+")|("+r+"\\s+\\d+)|",new RegExp(regex.slice(0,-1),"gi")},TimeIntel.prototype.prepareRegex=function(e,t){return"object"!=typeof e&&(e=[e]),t=t||"",t+e.join("|").replace(/\\/g,"\\\\").replace(/\b\/\b/g,"\\/").replace(/\s+/g,"\\s+").replace(/-/g,"\\-").replace(/\|/g,t+"|"+t)+t},TimeIntel.prototype.sortLocaleByPriority=function(){for(var e={combine:locale.combine,time:{},numbers:locale.numbers},t=Object.keys(locale.time).sort(function(e,t){return locale.time[e].priority-locale.time[t].priority}),o=0;o<t.length;o++)e.time[t[o]]=locale.time[t[o]];locale=e},TimeIntel.prototype.calculate=function(e){var t;switch(this.options.format){case"ms":t=1e3*e;break;case"s":t=e;break;case"m":t=e/60;break;case"h":t=e/3600;break;case"d":t=e/86400}return t},TimeIntel.prototype.text2num=function(e){"object"!=typeof e&&(e=[e]);for(var t=this.prepareRegex(Object.keys(locale.numbers.zero),"\\b"),o=this.prepareRegex(Object.keys(locale.numbers.digits)),r=this.prepareRegex(Object.keys(locale.numbers.tens)),n=this.prepareRegex(Object.keys(locale.numbers.doubles)),s=this.prepareRegex(locale.numbers.combine),i=new RegExp(t,"gi"),l=new RegExp(o,"gi"),a=new RegExp(r,"gi"),c=new RegExp(n,"gi"),p=new RegExp(locale.numbers.format.replace(/\[zero\]/g,t).replace(/\[digits\]/g,o).replace(/\[tens\]/g,r).replace(/\[doubles\]/g,n).replace(/\[combine\]/g,s),"i"),m=0;m<e.length;m++)for(var d=e[m].split(/[\s-]+/),u=0;u<d.length;u++)if(p.test(d[u]))if(i.test(d[u]))e[m]=e[m].replace(d[u],locale.numbers.zero[d[u].toLowerCase()]);else{var g=0;if(a.test(d[u]))g+=locale.numbers.tens[d[u].toLowerCase()];else{var f=d[u].match(c)?d[u].match(c)[0]:null;null!==f&&(d[u]=d[u].replace(f,""),g+=locale.numbers.doubles[f.toLowerCase()]);var h=d[u].match(a)?d[u].match(a)[0]:null;null!==h&&f!==d[u]&&(d[u]=d[u].replace(h,""),g+=locale.numbers.tens[h.toLowerCase()]);var b=d[u].match(l)?d[u].match(l)[0]:null;null!==b&&f!==d[u]&&h!==d[u]&&(g+=locale.numbers.digits[b.toLowerCase()])}e[m]=e[m].replace(d[u],g)}return e};